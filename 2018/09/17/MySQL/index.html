<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Madman's"><title> | Trtmu</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Trtmu</h1><a id="logo" href="/.">Trtmu</a><p class="description">2018/09/17</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 主页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-meta">Sep 17, 2018<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h2 id="MySql"><a href="#MySql" class="headerlink" title="MySql"></a>MySql</h2><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="数据库语言分类"><a href="#数据库语言分类" class="headerlink" title="数据库语言分类"></a>数据库语言分类</h3><ul>
<li>DDL(Data Definition Language)   数据定义语言,用于操作对象和对象的属性,这种对象包括数据库本身,以及数据库对象:表,视图等等,DDL对这些对象和属性的管理和定义具体表现在Create,Drop和Alter上,DDL语句不会对于具体的数据进行操作<ul>
<li>Create语句:可以创建数据库和数据库的一些对象</li>
<li>Drop语句:可以数据表,索引,触发器,条件约束以及数据表的权限等</li>
<li>Alert:修改数据表定义及属性</li>
</ul>
</li>
<li>DML(Data Manipulation Language)  数据操作语言,用于操作数据库对象中包含的数据<ul>
<li>Insert语句:向指定的数据表中插入一条记录</li>
<li>Delete语句:删除数据表中的一条或多条记录,也可以删除数据表中的所有记录,但实际上操作的依旧是记录</li>
<li>Update语句:用于修改已存在表中的记录的内容</li>
</ul>
</li>
<li>DCL(Data Control Language)  数据控制语句,用于操作数据库对象的权限,这里的数据库对象是指数据库用户<ul>
<li>Grant语句:允许对象的创建者给某用户或某组或所有用户某些指定的权限</li>
<li>Revoke语句:可以废除某用户或某组或所有用户访问权限</li>
</ul>
</li>
</ul>
<h3 id="Mysql其他知识点"><a href="#Mysql其他知识点" class="headerlink" title="Mysql其他知识点"></a>Mysql其他知识点</h3><ul>
<li><p>启动和关闭MySql服务<br><code>net start mysql</code><br><code>net stop mysql</code></p>
</li>
<li><p>MySql语句规范<br>关键字和函数名称大写<br>数据库名称，表名称，字段名称小写（只能使用字母数字和#__$）</p>
</li>
<li><p>数据类型：</p>
<ul>
<li>整型<br><code>tinyint</code>        1字节<br><code>smalint</code>        2字节<br><code>mediumint</code>        3字节<br><code>int</code>            4字节<br><code>bigint</code>        8字节  </li>
<li>浮点型<br><code>float（m,d）</code>            m指总的位数，d指小数点后的位数<br>double同理</li>
<li>字符型<br><code>char（M）</code>定长 0-255<br><code>varchar(M)</code>可变长度 0-65535<br><code>enum</code> 枚举<br><code>set</code> 集合</li>
</ul>
</li>
</ul>
<h3 id="数据库语言"><a href="#数据库语言" class="headerlink" title="数据库语言"></a>数据库语言</h3><ul>
<li>常用命令<br><code>select version（）</code>输出版本情况<br><code>select new（）</code>输出当前时间<br><code>select user（）</code>输出当前用户  </li>
</ul>
<h3 id="数据库操作（database）"><a href="#数据库操作（database）" class="headerlink" title="数据库操作（database）"></a>数据库操作（database）</h3><p>创建数据库 <code>create database 数据库名</code><br>查询所有数据库 <code>show databases</code><br>删除数据库 <code>drop database 数据库名</code><br>修改数据库 <code>alter database 数据库名</code> </p>
<h3 id="数据表操作（table）"><a href="#数据表操作（table）" class="headerlink" title="数据表操作（table）"></a>数据表操作（table）</h3><ul>
<li>进入数据表 <code>use 数据库名</code>  </li>
<li><p>新建数据表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 数据表名（</span><br><span class="line">	列 列数据类型，</span><br><span class="line">	...</span><br><span class="line">）；</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看数据表结构<code>show columns from 数据表名</code> 或者 <code>desc 表名</code>  </p>
</li>
<li>插入（添加数据）     <code>insert 表名（列名1，列名2...） values（列名对应的值）</code>  </li>
<li>查找数据             <code>select（字段） from 表名</code> </li>
<li>修改数据             <code>update 表名 set 列名=值  [条件];</code>  </li>
<li>删除数据             <code>delete from 表名 [条件]</code>  </li>
<li>数据表的列操作<br>插入（添加列）    <code>alter table 表名 add column 新增列名 数据类型 约束</code><br>删除列         <code>alter table 表名 drop column 列名</code><br>修改列属性     <code>alter table 表名 modify 待修改列名  数据类型</code><br>修改列名称     <code>alter table 表名 change column 原名 改名 数据类型</code>  </li>
</ul>
<h3 id="约束-约束也属于数据库对象"><a href="#约束-约束也属于数据库对象" class="headerlink" title="约束(约束也属于数据库对象)"></a>约束(约束也属于数据库对象)</h3><blockquote>
<p>优点：约束可以保证数据的完整性和一致性，约束分为表级约束及列级约束<br>删除外键的数据 cascade delete<br>设置外键列植为null，cascade set null</p>
</blockquote>
<ol>
<li>非空约束     <code>not null</code>设置此列可以为空</li>
<li>主键约束    <font color="red">每张数据表只能存在一个主键，一个主键可以定义在一个或多个字段上</font>主键能保证记录的唯一且不为空，主键默认为<code>not null</code>  使用 <code>primary key</code>设置此列为主键 ，<code>auto_increment</code> 设置自动编号.<font color="red">必须和主键一起使用，默认情况下起始值为1，每次自增1。</font></li>
<li>唯一约束     <code>unique key</code> 唯一约束保证数据的唯一性（这一列不可有重复元素），唯一约束的字段可以为空，且每张数据表可以存在多个唯一约束。</li>
<li>检查约束     <code>check</code> 检查，指定一个布尔表达式，用于指定对应列的值必须满足该表达式 </li>
<li>外键约束     <code>foreign key</code> <font color="red">取值范围必须是主表中某一主键列的值，外键的值可以为空，如果有值，必须是主表中有效的主键值</font>  </li>
</ol>
<h3 id="查询的扩展（都需要搭配select语句使用）"><a href="#查询的扩展（都需要搭配select语句使用）" class="headerlink" title="查询的扩展（都需要搭配select语句使用）"></a>查询的扩展（都需要搭配select语句使用）</h3><ul>
<li><p>聚合（统计）函数  <font color="red">统计函数只能有一个结果</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">计算某列的最大值`<span class="keyword">select</span> <span class="keyword">max</span>(列名) <span class="keyword">from</span> 表名<span class="string">`</span></span><br><span class="line"><span class="string">计算某列的最小值`</span><span class="keyword">select</span> <span class="keyword">min</span>(列名) <span class="keyword">from</span> 表名<span class="string">`</span></span><br><span class="line"><span class="string">计算某列的平均值`</span><span class="keyword">select</span> <span class="keyword">avg</span>(列名) <span class="keyword">from</span> 表名<span class="string">`</span></span><br><span class="line"><span class="string">计算某列的总和`</span><span class="keyword">select</span> <span class="keyword">sum</span>(列名) <span class="keyword">from</span> 表名<span class="string">`</span></span><br><span class="line"><span class="string">计算记录总数或某列的记录数量`</span><span class="keyword">count</span>(*)<span class="keyword">count</span>(列名)<span class="string">`</span></span><br><span class="line"><span class="string">查询所有记录总数，无论是否为null`</span><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> 表名<span class="string">`</span></span><br><span class="line"><span class="string">只查询指定列中不为null的记录总数。`</span><span class="keyword">select</span> <span class="keyword">count</span>(列名) <span class="keyword">from</span> 表名<span class="string">`</span></span><br><span class="line"><span class="string">返回的表是一个值，一个行值</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>常用运算符  </p>
<ul>
<li>比较运算符 <code>&gt;    &lt;    =    !=     &gt;=    &lt;=</code>  <ul>
<li>in （值1,值2） 在值1和值2之间<br><code>select * from worker where money in (5000,10000);</code>  </li>
<li>between 值1 and 值2<br><code>select * from worker where money between 5000 and 10000;</code>  </li>
</ul>
</li>
<li>逻辑运算符 <ul>
<li>and（逻辑与）    </li>
<li>or（逻辑或）    </li>
<li>not（逻辑非）</li>
</ul>
</li>
</ul>
</li>
<li><p>常用表达式    </p>
<ul>
<li>条件查询：<code>where</code>  列名</li>
<li>分组：<code>group by</code>  列名—-根据某一列来分组<br><code>select sex from worker group by sex;</code> </li>
<li>筛选：having—-条件表达式—-是否含有<br><code>select sex from worker group by sex having sex=&#39;男&#39;;</code><font color="red">必须与group by搭配使用，表示对分组的结果进行筛选。</font></li>
<li>排序：<code>order  by</code>  列名（默认为升序排序，如果要降序排序，后面加关键字<code>desc</code>）<br><code>select * from worker order by money</code><br><code>select * from worker order by money desc</code></li>
<li>条件：<code>limit m，n</code>m指从哪里开始，n指取几个  取出来的值不包含M对应的值<br><code>select bm from worker group by bm limit 0,4;（1-4）</code></li>
<li>模糊查询：<code>字段 like ‘通配符’</code><ul>
<li>通配符<ul>
<li><code>%</code>表示任意个数的任意字符    <ul>
<li><code>%a</code>表示以a结尾的字符串    </li>
<li><code>a%</code>表示以a开头的字符串<code>%a%</code>表示含有a的字符串</li>
</ul>
</li>
<li><code>_</code>表示一个字符 <ul>
<li><code>__洋</code>一串字符中含有洋且只有两个字  </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>子查询</strong>：指嵌套在查询内部的查询条件，且必须始终出现在圆括号内，子查询可以包含多个关键字或条件；子查询通常作为主查询的条件，通常是将子查询作为主查询的where条件来使用。<br><code>select * from(select  * from worker where bm=&#39;B部门&#39;)as a where a.money&gt;1000；（使用子查询查询B部门工资高于1000的人）</code></p>
</li>
<li><p>连接查询（多应用于多表查询）</p>
<ul>
<li>等值连接：指使用等号=比较两个表的连接项的值，相当于两表执行笛卡尔积后，取两表连接项相等的记录。<br><code>select * from worker,bumen;</code> 查找所有属于worker和bumen的列项。（笛卡尔积,也就是交集）</li>
<li>内连接（inner join on）<br><code>select a.name,a.money,a.bm,b.ver from worker as a join bumen as b on a.bm=b.bmname</code> 查找a,b两张表中 a的bm列和b.bmname相同时的所有列</li>
<li>外链接<ul>
<li>左外链接（left join或left outer join）<br>查询出的结果除了包含符合连接条件的记录外，还包含左表中剩余的其他记录。使用条件：需要将表2符合条件的元素加入表1时，且不会影响表1<br><code>select * from worker as a left join bumen as b on a.bm=b.bmname;</code></li>
<li>右外链接（right outer join 或right join）<br>查询出的结果除了包含符合连接条件的记录外，还包含右表中剩余的其他记录。使用条件：需要将表1符合条件的元素加入表2时，且不会影响表2<br><code>select * from worker as a right join bumen as b on a.bm=b.bmname;</code></li>
</ul>
</li>
</ul>
</li>
<li><p>常用函数</p>
<ul>
<li>字符串函数<ul>
<li>连接两个字符串的内容<br><code>select concat(name,bm) from worker;</code>  </li>
<li>使用连接符来连接字符串内容<br><code>select concat_ws(&quot;是&quot;,name,bm) from worker;</code>  </li>
<li>将字串转成大写    lower（str）将所有字符转成小写（调用者都为select）<br><code>select upper(&#39;aaaaaaasdas&#39;)； lower(&#39;AAAAAA&#39;);</code></li>
<li>取str的前num位<br><code>select left(&#39;aaaaaaasdas&#39;,6);</code>  </li>
<li>取str的后num位<br><code>select right(&#39;aaaaaaasdas&#39;,6)</code>  </li>
<li>进一取整：<code>select ceil(10.5456);  输出11</code>  </li>
<li>整数除法：<code>select 10 div 3; 输出3</code></li>
<li>舍一取整：<code>select floor（10.5456）输出10</code></li>
<li>取余数或模：<code>select 10 mod 3; 输出1</code></li>
<li>幂运算：<code>select power（2,3）输出8</code></li>
<li>四舍五入：<code>select round(2.5) 输出3</code></li>
<li>数字截取：<code>select truncate（123.35，-2）输出100</code></li>
</ul>
</li>
<li>日期时间函数：<ul>
<li>当前时间和日期 <code>new（）</code>     </li>
<li>当前日期 <code>curdate（）</code>    </li>
<li>当前时间 <code>curtime（）</code></li>
<li>日期的差值 <code>datediff（”2014-9-3”，”2015-9-6”）</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="SQL事务"><a href="#SQL事务" class="headerlink" title="SQL事务"></a>SQL事务</h3><ul>
<li>事务是一个逻辑工作单元的一系列操作，这些操作要么全部执行成功，要么全部执行失败</li>
<li>事务的特性：（ACID性）  <ul>
<li>原子性（Atomic）：事务内部的一系列操作不可再分，要么全部成功，要么全部失败。<ul>
<li>一致性（Consistent）：事务执行前后系统中数据的状态必须保持一致性。</li>
<li>隔离性（Isolation）：多个并发事务操作时，一个并发事务只能看到其他事务执行之前或执行之后的数据状态。不能查看其他事务执行过程中的数据状态。</li>
<li>持久性（Durative）:事务一旦执行成功，那么对系统数据的影响是持久性的。</li>
</ul>
</li>
</ul>
</li>
<li>MySQL中操作事务<br>MySQL默认一个SQL语句为一个事务.<ul>
<li>要想改变默认设置，则需使用：<code>start transaction</code> 或 <code>begin</code>  开启事务</li>
<li>提交事务 <code>commit</code>     </li>
<li>设置保存点 <code>savepoint 保存点名称</code>     </li>
<li>回滚到<code>begin</code>后一步  <code>rollback</code> </li>
<li>回滚到定义此保存点的位置 <code>rollback to 保存点名称</code> </li>
</ul>
</li>
<li><strong>事务的隔离级别</strong><ul>
<li>读未提交级别 <code>read uncommitted</code><blockquote>
<p>会出现“脏读””不可重复读””幻读”现象</p>
</blockquote>
</li>
<li>读提交级别 <code>read committed</code><blockquote>
<p>会出现“不可重复读”“幻读”现象</p>
</blockquote>
</li>
<li>可重复读级别 <code>repeatable read</code><blockquote>
<p>会出现“幻读”现象（InnoDB引擎可以避免“幻读”）</p>
</blockquote>
</li>
<li>串行化级别 <code>serializable</code><blockquote>
<p>最高的隔离级别<br><code>serializable</code></p>
</blockquote>
</li>
</ul>
</li>
<li><p>术语解释：<br><strong>脏读</strong>：一个事务读取了另一个事务修改的但未提交的数据（脏数据）<br><strong>不可重复读</strong>：一个事务两次读取了其他事务不同的修改的提交的数据，导致了两次读取的结果不一致。<br><strong>幻读</strong>：一个事务两次读取的数据记录数量不一致，通常的原因是其他事务增加或删除了记录。</p>
</li>
<li><p>查看当前隔离级别<br><code>select @@tx_isolation;</code>  </p>
</li>
<li>设置当前会话的隔离级别的命令<br><code>set session transaction isolation level read uncommitted /read committed /repeatable read /serializable;</code>  </li>
<li>事务的其他概念<blockquote>
<p>事务的实现是基于数据库的存储引擎，不同的存储引擎对事务的支持程度不一样，<strong>MySQL中支持事务的存储引擎有innoDB和NDB。</strong>innoDB是MySQL默认的存储引擎，默认的隔离级别是RR（repeatable read），并且在RR的隔离级别下更进一步，通过多版本并发控制（MVCC，Multiversion Concurrency Control）解决了不可重复读问题，加上间隙锁（也就是并发控制）解决幻读问题。因此innoDB的RR隔离级别其实实现了串行化级别的效果，而且保留了比较好的并发性能。</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>事务的隔离性是通过锁实现，而事务的原子性、一致性和持久性是通过事务日志实现。<br>    事务日志通过重做（redo）日志和innoDB 存储引擎的日志缓冲（InnoDB Log Buffer）实现<br>    undo log 主要为事务的回滚服务，undo log记录了数据在每个操作前的状态<br>    redo log保障的是事务的持久性和一直性，而undo log保障了事务的原子性。</p>
</blockquote>
<ul>
<li>SQL用户操作及密码操作 <ul>
<li>创建用户：<br><code>create user ‘用户名’@‘主机名’identified by ‘密码’；</code>  </li>
<li>授予权限：<code>grant select|insert|delete|update|all on 数据库名称.表名称 to &#39;用户名&#39;@&#39;主机名&#39;;</code></li>
<li>创建用户后分配权限： <code>grant [权限] on 数据库名称.表名称 to &#39;用户名&#39;@&#39;主机名&#39; identified by &#39;密码&#39;;</code></li>
<li>收回权限：<code>revoke [权限] on 数据库名称.表名称 from &#39;用户名&#39;@&#39;主机名&#39;</code></li>
<li>修改密码：<br><code>update user set password=password(&#39;新密码&#39;) where user=&#39;用户名&#39;;</code><br><code>flush privileges;</code></li>
</ul>
</li>
<li>数据库的备份和恢复  <ol>
<li>备份数据库—将服务器里面的数据库备份成一个.sql文件<br><code>mysqldump -u用户名 -p密码 --databases testdb &gt; 备份路径 (e:\bak.sql)</code></li>
<li>还原数据库—-将.sql文件再还原到数据库<br><code>mysql -u用户名 -p密码 &lt; 还原路径 (e:\dbbak.sql)</code></li>
<li>备份数据库中的表<br><code>mysqldump -u用户名 -p密码 数据库名称 表名称 &gt; 备份路径 (eg: e:\tabbak.sql)</code><ol start="4">
<li>还原数据库中的表<br><code>mysql -u用户名 -p密码 要还原到的数据库名称 &lt; 还原路径 (eg: e:\tabbak.sql)</code></li>
</ol>
</li>
</ol>
</li>
</ul>
<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><ul>
<li>存储过程是一组为了完成特定功能的SQl语句集 ，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行.</li>
<li><p>优点：增强SQl语言的功能和灵活性；是标准的组件式编程；有较快的执行速度；可以减少网络流量；作为一种安全机制来充分利用</p>
</li>
<li><p>存储过程中的定义<br>变量赋值的语法： <code>set 变量名=变量值；</code> </p>
<blockquote>
<p>用户变量一般以@开头</p>
</blockquote>
</li>
<li><p>在方法或者存储过程中定义一个临时变量的方法：<br><code>declare 变量名 变量类型 default  值；</code></p>
</li>
</ul>
<blockquote>
<p><strong>参数：存储过程根据需要可以有输入、输出、输入输出参数，如果有多个参数使用逗号分隔。（in out inout）<br>in参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值<br>out 参数的值可在存储过程内部被改变和返回<br>inout参数的值需要在调用时指定，且可被改变和返回</strong></p>
</blockquote>
<ul>
<li>改变默认的结束标志使用关键字 <code>delimiter 符号</code> </li>
</ul>
<p>自定义存储过程:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create procedure 名称（参数类型  参数  参数数据类型）</span><br><span class="line">	begin</span><br><span class="line">	....</span><br><span class="line">	end</span><br><span class="line">	结束标志</span><br></pre></td></tr></table></figure></p>
<p><font color="red">存储过程的调用要使用call</font></p>
<blockquote>
<p>特殊语句:选择语句（case）、条件语句（if）、循环语句（while）都需要关闭（end if）</p>
</blockquote>
<h3 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h3><ul>
<li><p>函数必须在库中调用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> nummm(<span class="keyword">num</span> <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">returns</span> <span class="built_in">int</span></span><br><span class="line">	<span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">num</span>+<span class="number">80</span>;</span><br><span class="line">	<span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><font color="red">自定义函数的调用要使用select</font></p>
<h3 id="MySQL中的触发器"><a href="#MySQL中的触发器" class="headerlink" title="MySQL中的触发器"></a>MySQL中的触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimter //     <span class="comment">/*改变结束标志*/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> 触发器名称 <span class="keyword">before</span>|<span class="keyword">after</span>  触发事件(<span class="keyword">insert</span>|<span class="keyword">delete</span>|<span class="keyword">update</span>) <span class="keyword">on</span> 触发器关联的表名称 <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">触发器执行的逻辑代码</span><br><span class="line"><span class="keyword">end</span>//</span><br><span class="line">delimter //</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
</blockquote>
<p><strong> MySQL的查询优化方法</strong></p>
<blockquote>
<ul>
<li>优化查询SQL语句。如果连接查询和子查询都可以查询到结果，则优先选择连接查询。因为子查询是会常见零时表，临时表的内容是储存子查询结果的，查询完毕后，还有撤销临时表</li>
<li>在频繁使用的列上创建索引（index）</li>
<li>拆表。如果一个表中的字段很多，应该讲不常使用的字段存储在另一张表中，原表只保留常用查询字段。</li>
<li>增加冗余字段。将需要经常使用的信息以冗余字段的方式添加到表中，省去连接查询的耗时。</li>
<li>增加中间表。建立一个中间表，将多张表的查询字段存放在此中间表中。</li>
</ul>
</blockquote>
<h2 id="Java与MySQl的交互"><a href="#Java与MySQl的交互" class="headerlink" title="Java与MySQl的交互"></a>Java与MySQl的交互</h2><h3 id="使用JDBC数据库连接"><a href="#使用JDBC数据库连接" class="headerlink" title="使用JDBC数据库连接"></a>使用JDBC数据库连接</h3><p>常用类：<br>DriverManager类<br>方法：<code>public static Connection getConnection(String url,String user,String password)</code><br>获取数据库连接对象。<br>Connection (数据库连接对象)<br>方法：<code>PreparedStatement prepareStatement(String sql)</code><br><code>void close();//关闭数据库连接</code><br>PreparedStatement(表示预编译的SQL语句的对象，使用此对象操作数据库)<br><code>setInt(int parameterIndex,int x)</code><br><code>int executeUpdate()// 执行增、删、改操作。返回：影响表中记录的行数。</code><br><code>ResultSet executeQuery()// 执行查询操作。 返回：ResultSet结果集</code><br>JDBC操作数据库的步骤</p>
<ol>
<li>加载驱动<code>Class.forName(“org.gjt.mm.mysql.Driver”)</code><br>与数据库建立连接 (创建Connection 对象)</li>
<li><code>Connection con=DriverManager.getConnection()</code><br>根据连接获取操作对象（创建PreparedStatement对象）进行数据操作（使用此操作对象执行sql语句）</li>
<li><code>PreparedStatement ps=con.prepareStatement(&quot;SQL语句&quot;);</code><br><code>ps.executeUpdate();</code>   // 增、删、改<br><code>ResultSet rs=ps.executeQuery();</code>   // 查询<br>遍历结果集（rs）</li>
<li>关闭数据库<br><code>con.close();</code></li>
</ol>
<p>例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用JDBC连接数据库</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getC</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Class.forName(<span class="string">"org.gjt.mm.mysql.Driver"</span>);</span><br><span class="line">		Connection con = DriverManager.getConnection(</span><br><span class="line">				<span class="string">"jdbc:mysql://localhost:3306/java1704"</span>,<span class="string">"root"</span>, <span class="string">"123"</span>);</span><br><span class="line">		<span class="keyword">return</span> con;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用JDBC操作事务<br>Connection对象对于事务的支持：<br><code>setAutoCommit(boolean autoCommit)</code>设置自动提交模式，为false表示禁用自动提交模式<br><code>Savepoint setSavepoint（String name）</code>在当前事务中创建一个具有给定名称的保存点<br><code>rollback（）</code> 取消在当前事务中进行的所有更改<br><code>rollback（Savepoint savepoint）</code>回退到保存点状态<br><code>commit（）</code>提交事务</p>
<h3 id="DBCP数据库连接池-（database-connection-poll）"><a href="#DBCP数据库连接池-（database-connection-poll）" class="headerlink" title="DBCP数据库连接池 （database connection poll）"></a>DBCP数据库连接池 （database connection poll）</h3><p>原理：在访问数据库的过程中，数据库连接（connection）是一种很重要且获取很耗时的资源，数据库连接池可以保存一些连接供用户操作，使用完成后将连接重新放回连接池等待重用。数据库连接池可以对连接对象进行分配、管理、重用<br>使用 BasicDataSource建立连接<br>代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 需要数据库连接池库 需手动设置驱动、数据库地址、用户名及密码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getC</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		BasicDataSource ds = <span class="keyword">new</span> BasicDataSource();</span><br><span class="line">		ds.setDriverClassName(<span class="string">"org.gjt.mm.mysql.Driver"</span>);</span><br><span class="line">		ds.setUrl(<span class="string">"jdbc:mysql://localhost:3306/java1704"</span>);</span><br><span class="line">		ds.setUsername(<span class="string">"root"</span>);</span><br><span class="line">		ds.setPassword(<span class="string">"123"</span>);</span><br><span class="line">		System.out.println(<span class="string">"-------"</span>);</span><br><span class="line">		Connection con = ds.getConnection();</span><br><span class="line">		<span class="keyword">return</span> con;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="使用工厂类获取连接（对配置文件的key有严格要求）"><a href="#使用工厂类获取连接（对配置文件的key有严格要求）" class="headerlink" title="使用工厂类获取连接（对配置文件的key有严格要求）"></a>使用工厂类获取连接（对配置文件的key有严格要求）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 需配置文件（dbcpfactory.properties）配置文件需设置数据      *库地址等属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getC</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">	<span class="comment">// 读取配置文件</span></span><br><span class="line">	InputStream in = ProDemo.class.getClassLoader().getResourceAsStream(</span><br><span class="line">			<span class="string">"dbcpfactory.properties"</span>);</span><br><span class="line">	pro.load(in);<span class="comment">// 加载配置文件</span></span><br><span class="line">	<span class="comment">// 使用工厂对象获取数据源</span></span><br><span class="line">	DataSource ds = BasicDataSourceFactory.createDataSource(pro);</span><br><span class="line">	<span class="comment">// 获取数据库连接对象</span></span><br><span class="line">	Connection con = ds.getConnection();</span><br><span class="line">	<span class="keyword">return</span> con;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="C3P0连接池"><a href="#C3P0连接池" class="headerlink" title="C3P0连接池"></a>C3P0连接池</h3><p>步骤：</p>
<p><font color="red"><strong>将配置文件（c3p0-config.xml）传入项目的src目录下!!!!!!!!</strong></font><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getC</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		ComboPooledDataSource ds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">		Connection con = ds.getConnection();</span><br><span class="line">		<span class="keyword">return</span> con;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/09/17/Servlet笔记/"></a><a class="next" href="/2018/09/17/代码总结/"></a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://yoursite.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Trtmu.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>